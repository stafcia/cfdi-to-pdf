{"version":3,"file":"cfdi-to-pdf.umd.js","sources":["../../src/abstract-invoice-data.ts","../../src/utils/currency.ts","../../src/utils/break-characters.ts","../../src/exceptions/pdfmake-not-found.ts","../../src/pdfmake-builder.ts","../../src/templates/complements/pago10-complement.ts","../../src/templates/complements/pago20-complement.ts","../../src/cfdi-data.ts","../../src/templates/generic-cfdi-translator.ts","../../src/templates/complements/imp-local10-complement.ts","../../src/templates/generic-retenciones-translator.ts","../../src/builders/pdf-maker-browser-builder.ts","../../src/builders/pdf-maker-builder.ts","../../src/retenciones-data.ts"],"sourcesContent":["import { DiscoverExtractor } from '@nodecfdi/cfdi-expresiones';\nimport { CNodeInterface, XmlNodeUtils, getParser } from '@nodecfdi/cfdiutils-common';\n\nexport abstract class AbstractInvoiceData {\n    protected _emisor!: CNodeInterface;\n\n    protected _receptor!: CNodeInterface;\n\n    protected _timbreFiscalDigital!: CNodeInterface;\n\n    protected _qrUrl!: string;\n\n    protected _tfdSourceString!: string;\n\n    protected _logo: string | undefined;\n\n    protected _additionalFields: { title: string; value: string }[] | undefined;\n\n    protected _additionalFieldsUP: { title: string; value: string }[] | undefined;\n\n    public emisor(): CNodeInterface {\n        return this._emisor;\n    }\n\n    public receptor(): CNodeInterface {\n        return this._receptor;\n    }\n\n    public timbreFiscalDigital(): CNodeInterface {\n        return this._timbreFiscalDigital;\n    }\n\n    public qrUrl(): string {\n        return this._qrUrl;\n    }\n\n    public tfdSourceString(): string {\n        return this._tfdSourceString;\n    }\n\n    public logo(): string | undefined {\n        return this._logo;\n    }\n\n    public additionalFields(): { title: string; value: string }[] | undefined {\n        return this._additionalFields;\n    }\n\n    public additionalFieldsUP(): { title: string; value: string }[] | undefined {\n        return this._additionalFieldsUP;\n    }\n\n    public buildUrlQr(node: CNodeInterface): void {\n        const rawString = XmlNodeUtils.nodeToXmlString(node, true);\n        const document = getParser().parseFromString(rawString, 'text/xml');\n        try {\n            this._qrUrl = new DiscoverExtractor().extract(document);\n        } catch (e) {\n            // not generated qrURL\n        }\n    }\n}\n","const getGroupToCurrency = (group: string): string => {\n    // necessary arrays needed to convert from numbers to currency\n    const basics = [\n        'cero',\n        'un',\n        'dos',\n        'tres',\n        'cuatro',\n        'cinco',\n        'seis',\n        'siete',\n        'ocho',\n        'nueve',\n        'diez',\n        'once',\n        'doce',\n        'trece',\n        'catorce',\n        'quince'\n    ];\n    const teens = [\n        '',\n        'dieci',\n        'veinti',\n        'treinta',\n        'cuarenta',\n        'cincuenta',\n        'sesenta',\n        'setenta',\n        'ochenta',\n        'noventa'\n    ];\n    const hundreds = [\n        '',\n        'ciento',\n        'doscientos',\n        'trescientos',\n        'cuatrocientos',\n        'quinientos',\n        'seiscientos',\n        'setecientos',\n        'ochocientos',\n        'novecientos'\n    ];\n    // variable used to temporarily store currency\n    let toCurrency = '';\n    // handle hundreds\n    if (group.length === 3) {\n        switch (parseInt(group, 10)) {\n            case 100:\n                return 'cien ';\n            case 0:\n                return '';\n            default:\n                toCurrency += `${hundreds[parseInt(group[0], 10)]} `;\n        }\n        group = group.substring(1, 3);\n    }\n    // handle teens and 'basic' numbers\n    if (parseInt(group, 10) <= 15) {\n        // if group is less than 15, select from basics array\n        if (group === '00') {\n            return toCurrency;\n        }\n        toCurrency += `${basics[parseInt(group, 10)]} `;\n    } else {\n        // else look for the number in both teens and basics arrays\n        const zeroAtTheEnd = group[1] === '0';\n        switch (parseInt(group, 10)) {\n            case 20:\n                return `${toCurrency}veinte `;\n            default:\n                toCurrency += `${\n                    teens[parseInt(group[0], 10)] +\n                    (parseInt(group[0], 10) >= 3 && !zeroAtTheEnd ? ' y ' : '') +\n                    (zeroAtTheEnd ? '' : basics[parseInt(group[1], 10)])\n                } `;\n        }\n    }\n\n    return toCurrency;\n};\n\nconst toCurrency = (num: number, moneda?: string): string => {\n    // number to string\n    const number = num.toFixed(2);\n    // separate decimals (only 2) and integers\n    let integers = number.substring(0, number.indexOf('.'));\n    const decimals = number.substring(number.indexOf('.') + 1, number.length);\n    const monedaName = !moneda || moneda === 'MXN' ? 'M.N.' : moneda;\n    // initialize string to store currency\n    let numberToCurrency = '';\n    // some helpful variables\n    let noThousands = false;\n    let noHundreds = false;\n    let thousandsOfMillions = false;\n    // Maximum supported number is 999,999,999,999.99\n    if (integers.length <= 12) {\n        // evaluate each group of 3 digits (hundreds, thousands, millions, thousands of millions)\n        // evaluate thousands of millions\n        if (integers.length === 12 || integers.length === 11 || integers.length === 10) {\n            const group = integers.substring(0, integers.length - 9);\n            thousandsOfMillions = true;\n            switch (parseInt(group, 10)) {\n                /* istanbul ignore next */\n                case 0:\n                    break;\n                case 1:\n                    numberToCurrency += 'mil ';\n                    break;\n                default:\n                    numberToCurrency += `${getGroupToCurrency(group)}mil `;\n            }\n            integers = integers.substring(integers.length - 9, integers.length);\n        }\n        // evaluate millions\n        if (integers.length === 9 || integers.length === 8 || integers.length === 7) {\n            const group = integers.substring(0, integers.length - 6);\n            numberToCurrency += getGroupToCurrency(group);\n            if (!thousandsOfMillions && parseInt(group, 10) === 1) {\n                numberToCurrency += 'millón ';\n            } else {\n                numberToCurrency += 'millones ';\n            }\n            integers = integers.substring(integers.length - 6, integers.length);\n        }\n        // evaluate thousands\n        if (integers.length === 6 || integers.length === 5 || integers.length === 4) {\n            const group = integers.substring(0, integers.length - 3);\n            noThousands = parseInt(group, 10) === 0;\n            switch (parseInt(group, 10)) {\n                case 0:\n                    break;\n                case 1:\n                    numberToCurrency += 'mil ';\n                    break;\n                default:\n                    numberToCurrency += `${getGroupToCurrency(group)}mil `;\n            }\n            integers = integers.substring(integers.length - 3, integers.length);\n        }\n        // evaluate hundreds\n        noHundreds = parseInt(integers, 10) === 0;\n        numberToCurrency += getGroupToCurrency(integers);\n        numberToCurrency += `${\n            (noThousands && noHundreds ? 'de ' : '') + (numberToCurrency === 'un ' ? 'peso ' : 'pesos ') + decimals\n        }/100 ${monedaName}`;\n\n        return numberToCurrency.toUpperCase();\n    } else {\n        throw new Error('El número es demasiado grande.');\n    }\n};\n\nconst formatCurrency = (currency: number | string): string => {\n    if (typeof currency === 'string') {\n        currency = Number(currency);\n    }\n\n    const number = Number.isNaN(currency) ? 0 : Number(currency);\n\n    return Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', currencyDisplay: 'symbol' }).format(number);\n};\n\nexport { toCurrency, formatCurrency };\n","const breakEveryNCharacters = (str: string, n = 86): string => {\n    const arr = str.match(new RegExp(`.{1,${n}}`, 'g'));\n    let result = str;\n    if (arr) {\n        result = arr.reduce((a, b) => {\n            return `${a}\\n${b}`;\n        });\n    }\n\n    return result;\n};\n\nexport { breakEveryNCharacters };\n","export class PdfmakeNotFound extends Error {\n    constructor(msg: string) {\n        super(msg);\n        this.name = 'PdfmakeNotFound';\n    }\n}\n","import { BufferOptions, CustomTableLayout, TDocumentDefinitions, TFontDictionary } from 'pdfmake/interfaces';\nimport { PdfmakeNotFound } from './exceptions/pdfmake-not-found';\n\nexport interface PdfKitDocument extends NodeJS.ReadableStream {\n    end(): void;\n}\n\nexport interface TCreatedPdf {\n    download(cb?: () => void, options?: BufferOptions): void;\n    download(defaultFileName: string, cb?: () => void, options?: BufferOptions): void;\n    getBlob(cb: (result: Blob) => void, options?: BufferOptions): void;\n    getBase64(cb: (result: string) => void, options?: BufferOptions): void;\n    getBuffer(cb: (result: Buffer) => void, options?: BufferOptions): void;\n    getDataUrl(cb: (result: string) => void, options?: BufferOptions): void;\n    getStream(options?: BufferOptions): PdfKitDocument;\n    open(options?: BufferOptions, win?: Window | null): void;\n    print(options?: BufferOptions, win?: Window | null): void;\n}\n\nexport interface PdfMakeBrowser {\n    createPdf(\n        documentDefinitions: TDocumentDefinitions,\n        tableLayouts?: { [name: string]: CustomTableLayout },\n        fonts?: TFontDictionary,\n        vfs?: { [file: string]: string }\n    ): TCreatedPdf;\n}\n\nexport interface PdfMakeNode {\n    createPdfKitDocument(docDefinition: TDocumentDefinitions, options?: BufferOptions): PdfKitDocument;\n}\n\nlet _pdfmake: PdfMakeBrowser | PdfMakeNode | undefined;\n\nconst getPdfMake = <T extends PdfMakeBrowser | PdfMakeNode>(): T => {\n    if (!_pdfmake) {\n        throw new PdfmakeNotFound('No pdfmake was provided.');\n    }\n\n    return _pdfmake as T;\n};\n\nconst installPdfMake = (pdfMake: PdfMakeBrowser | PdfMakeNode): void => {\n    _pdfmake = pdfMake;\n};\n\nexport { getPdfMake, installPdfMake };\n","import { CNodeInterface, CNodes } from '@nodecfdi/cfdiutils-common';\nimport { Content, TableCell } from 'pdfmake/interfaces';\nimport { formatCurrency } from '../../utils/currency';\n\nconst generateRelatedDocsContent = (doctoRelacionados: CNodes): TableCell[][] => {\n    const relatedDocsCells = doctoRelacionados.map<TableCell[]>((doc) => {\n        return [\n            doc.get('IdDocumento'),\n            doc.get('MetodoDePagoDR'),\n            doc.get('MonedaDR'),\n            doc.get('TipoCambioDR'),\n            doc.get('NumParcialidad'),\n            formatCurrency(doc.get('ImpSaldoAnt') || '0'),\n            formatCurrency(doc.get('ImpPagado') || '0'),\n            formatCurrency(doc.get('ImpSaldoInsoluto') || '0')\n        ];\n    });\n    relatedDocsCells.unshift([\n        'UUID',\n        'Método de Pago',\n        'Moneda',\n        'Tipo de Cambio',\n        'Num. Parcialidad',\n        'Importe Saldo Anterior',\n        'Importe Pagado',\n        'Importe Saldo Insoluto'\n    ]);\n    relatedDocsCells.unshift([\n        {\n            text: 'DOCUMENTOS RELACIONADOS',\n            style: 'tableHeader',\n            colSpan: 8,\n            alignment: 'center'\n        },\n        {},\n        {},\n        {},\n        {},\n        {},\n        {},\n        {}\n    ]);\n\n    return relatedDocsCells;\n};\n\nconst usePago10Complement = (comprobante: CNodeInterface, currentContent: Content[]): void => {\n    // Verify if exists pago10 complement\n    const pago10 = comprobante.searchNode('cfdi:Complemento', 'pago10:Pagos');\n    if (!pago10) return;\n\n    const pagos = pago10.searchNodes('pago10:Pago');\n    if (pagos.length > 0) {\n        for (const pago of pagos) {\n            const doctoRelacionados = pago.searchNodes('pago10:DoctoRelacionado');\n            currentContent.push({\n                style: 'tableContent',\n                table: {\n                    widths: [95, '*', 95, '*'],\n                    body: [\n                        [\n                            {\n                                text: 'INFORMACIÓN DE PAGO',\n                                style: 'tableHeader',\n                                colSpan: 4,\n                                alignment: 'center'\n                            },\n                            {},\n                            {},\n                            {}\n                        ],\n                        ['FECHA:', pago.get('FechaPago'), 'FORMA PAGO:', pago.get('FormaDePagoP')],\n                        ['MONEDA:', pago.get('MonedaP'), 'MONTO:', formatCurrency(pago.get('Monto') || '0')],\n                        pago.offsetExists('TipoCambioP')\n                            ? ['TIPO DE CAMBIO:', pago.get('TipoCambioP'), '', '']\n                            : ['', '', '', '']\n                    ]\n                },\n                layout: 'lightHorizontalLines'\n            });\n            currentContent.push('\\n');\n            currentContent.push({\n                style: 'tableList',\n                table: {\n                    widths: ['*', 'auto', 'auto', 30, 20, 'auto', 'auto', 'auto'],\n                    body: generateRelatedDocsContent(doctoRelacionados)\n                },\n                layout: {\n                    fillColor(i: number): string | null {\n                        return i % 2 !== 0 ? '#CCCCCC' : null;\n                    }\n                }\n            });\n            currentContent.push('\\n');\n        }\n    }\n};\n\nexport { usePago10Complement };\n","import { CNodeInterface, CNodes } from '@nodecfdi/cfdiutils-common';\nimport { Content, TableCell } from 'pdfmake/interfaces';\nimport { formatCurrency } from '../../utils/currency';\n\nconst generateRelatedDocsContent = (doctoRelacionados: CNodes): TableCell[][] => {\n    const relatedDocsCells = doctoRelacionados.map<TableCell[]>((doc) => {\n        return [\n            doc.get('IdDocumento'),\n            `${doc.get('Serie')}/${doc.get('Folio')}`,\n            doc.get('MonedaDR'),\n            doc.get('EquivalenciaDR'),\n            doc.get('NumParcialidad'),\n            formatCurrency(doc.get('ImpSaldoAnt') || '0'),\n            formatCurrency(doc.get('ImpPagado') || '0'),\n            formatCurrency(doc.get('ImpSaldoInsoluto') || '0')\n        ];\n    });\n    relatedDocsCells.unshift([\n        'UUID',\n        'Serie / Folio',\n        'Moneda',\n        'Tipo de Cambio',\n        'Num. Parcialidad',\n        'Importe Saldo Anterior',\n        'Importe Pagado',\n        'Importe Saldo Insoluto'\n    ]);\n    relatedDocsCells.unshift([\n        {\n            text: 'DOCUMENTOS RELACIONADOS',\n            style: 'tableHeader',\n            colSpan: 8,\n            alignment: 'center'\n        },\n        {},\n        {},\n        {},\n        {},\n        {},\n        {},\n        {}\n    ]);\n\n    return relatedDocsCells;\n};\n\nconst checkAndAddTotal = (totales: CNodeInterface, attribute: string, rowToInsert: TableCell[]): void => {\n    if (totales.offsetExists(attribute)) {\n        rowToInsert.push({\n            text: `${attribute}: ${totales.get(attribute)}`,\n            fontSize: 7\n        });\n    }\n};\n\nconst generateTotalesInfoContent = (totales: CNodeInterface): TableCell[][] => {\n    const totalesCells: TableCell[][] = [];\n\n    const firstRow: TableCell[] = [];\n    const secondRow: TableCell[] = [];\n\n    checkAndAddTotal(totales, 'TotalRetencionesIVA', firstRow);\n    checkAndAddTotal(totales, 'TotalRetencionesISR', firstRow);\n    checkAndAddTotal(totales, 'TotalRetencionesIEPS', firstRow);\n    checkAndAddTotal(totales, 'TotalTrasladosBaseIVA16', firstRow);\n    checkAndAddTotal(totales, 'TotalTrasladosImpuestoIVA16', firstRow);\n\n    checkAndAddTotal(totales, 'TotalTrasladosBaseIVA8', secondRow);\n    checkAndAddTotal(totales, 'TotalTrasladosImpuestoIVA8', secondRow);\n    checkAndAddTotal(totales, 'TotalTrasladosBaseIVA0', secondRow);\n    checkAndAddTotal(totales, 'TotalTrasladosImpuestoIVA0', secondRow);\n    checkAndAddTotal(totales, 'TotalTrasladosBaseIVAExento', secondRow);\n\n    totalesCells.push([\n        {\n            text: 'Totales',\n            colSpan: 2,\n            alignment: 'center',\n            bold: true,\n            border: [true, true, false, true]\n        },\n        {},\n        {\n            text: `Monto Total: ${formatCurrency(totales.get('MontoTotalPagos'))}`,\n            colSpan: 3,\n            alignment: 'center',\n            bold: true,\n            border: [false, true, true, true]\n        },\n        {},\n        {}\n    ]);\n\n    if (firstRow.length > 0) {\n        const limit = 5 - firstRow.length;\n        for (let i = 0; i < limit; i++) {\n            firstRow.push({});\n        }\n        totalesCells.push(firstRow);\n    }\n\n    if (secondRow.length > 0) {\n        const limit = 5 - secondRow.length;\n        for (let i = 0; i < limit; i++) {\n            secondRow.push({});\n        }\n        totalesCells.push(secondRow);\n    }\n\n    return totalesCells;\n};\n\nconst usePago20Complement = (comprobante: CNodeInterface, currentContent: Content[]): void => {\n    // Verify if exists pago20 complement\n    const pago20 = comprobante.searchNode('cfdi:Complemento', 'pago20:Pagos');\n    if (!pago20) return;\n\n    const totales = pago20.searchNode('pago20:Totales');\n    const pagos = pago20.searchNodes('pago20:Pago');\n\n    if (pagos.length > 0 && totales !== undefined) {\n        currentContent.push({\n            style: 'tableContent',\n            table: {\n                widths: ['20%', '20%', '20%', '20%', '20%'],\n                body: generateTotalesInfoContent(totales)\n            }\n        });\n        currentContent.push('\\n');\n        for (const pago of pagos) {\n            const doctoRelacionados = pago.searchNodes('pago20:DoctoRelacionado');\n            currentContent.push({\n                style: 'tableContent',\n                table: {\n                    widths: [95, '*', 95, '*'],\n                    body: [\n                        [\n                            {\n                                text: 'INFORMACIÓN DE PAGO',\n                                style: 'tableHeader',\n                                colSpan: 4,\n                                alignment: 'center'\n                            },\n                            {},\n                            {},\n                            {}\n                        ],\n                        ['FECHA:', pago.get('FechaPago'), 'FORMA PAGO:', pago.get('FormaDePagoP')],\n                        ['MONEDA:', pago.get('MonedaP'), 'MONTO:', formatCurrency(pago.get('Monto') || '0')],\n                        pago.offsetExists('TipoCambioP')\n                            ? ['TIPO DE CAMBIO:', pago.get('TipoCambioP'), {}, {}]\n                            : [{}, {}, {}, {}]\n                    ]\n                },\n                layout: 'lightHorizontalLines'\n            });\n            currentContent.push({\n                style: 'tableList',\n                table: {\n                    widths: ['*', 'auto', 'auto', 25, 20, 'auto', 'auto', 'auto'],\n                    body: generateRelatedDocsContent(doctoRelacionados)\n                },\n                layout: {\n                    fillColor(i: number): string | null {\n                        return i % 2 !== 0 ? '#CCCCCC' : null;\n                    }\n                }\n            });\n            currentContent.push('\\n');\n            currentContent.push('\\n');\n        }\n    }\n};\n\nexport { usePago20Complement };\n","import { CNodeInterface } from '@nodecfdi/cfdiutils-common';\nimport { AbstractInvoiceData } from './abstract-invoice-data';\n\nexport class CfdiData extends AbstractInvoiceData {\n    private readonly _comprobante: CNodeInterface;\n\n    private readonly _address: string | undefined;\n\n    constructor(\n        comprobante: CNodeInterface,\n        qrUrl: string,\n        tfdSourceString: string,\n        logo?: string,\n        address?: string,\n        additionalFields?: { title: string; value: string }[],\n        additionalFieldsUP?: { title: string; value: string }[]\n    ) {\n        super();\n        const emisor = comprobante.searchNode('cfdi:Emisor');\n        if (!emisor) {\n            throw new Error('El CFDI no contiene nodo emisor');\n        }\n        const receptor = comprobante.searchNode('cfdi:Receptor');\n        if (!receptor) {\n            throw new Error('El CFDI no contiene nodo receptor');\n        }\n        const timbreFiscalDigital = comprobante.searchNode('cfdi:Complemento', 'tfd:TimbreFiscalDigital');\n        if (!timbreFiscalDigital) {\n            throw new Error('El CFDI no contiene complemento de timbre fiscal digital');\n        }\n\n        this._comprobante = comprobante;\n        this._emisor = emisor;\n        this._receptor = receptor;\n        this._timbreFiscalDigital = timbreFiscalDigital;\n        this._qrUrl = qrUrl;\n        this._tfdSourceString = tfdSourceString;\n        this._logo = logo;\n        this._address = address;\n        this._additionalFields = additionalFields;\n        this._additionalFieldsUP = additionalFieldsUP;\n        if (this._qrUrl.trim().length === 0) {\n            this.buildUrlQr(this._comprobante);\n        }\n    }\n\n    public comprobante(): CNodeInterface {\n        return this._comprobante;\n    }\n\n    public address(): string | undefined {\n        return this._address;\n    }\n}\n","import {\n    Column,\n    Content,\n    ContentColumns,\n    ContentTable,\n    Style,\n    TableCell,\n    TDocumentDefinitions\n} from 'pdfmake/interfaces';\nimport { CNodeInterface, CNodes } from '@nodecfdi/cfdiutils-common';\nimport { DocumentTranslatorInterface } from './document-translator-interface';\nimport { CfdiData } from '../cfdi-data';\nimport { formatCurrency, toCurrency } from '../utils/currency';\nimport { breakEveryNCharacters } from '../utils/break-characters';\nimport { usePago10Complement } from './complements/pago10-complement';\nimport { usePago20Complement } from './complements/pago20-complement';\nimport { useImpLocal10Complement } from './complements/imp-local10-complement';\n\nexport class GenericCfdiTranslator implements DocumentTranslatorInterface<CfdiData> {\n    protected generateFooter(version: string, uuid: string, currentPage: number, pageCount: number): Content {\n        return {\n            style: 'tableContent',\n            table: {\n                widths: ['auto', '*', 'auto', 'auto'],\n                body: [\n                    [\n                        {\n                            text: `Este documento es una representación impresa de un Comprobante Fiscal Digital a través de Internet versión ${version}`,\n                            style: 'tableList',\n                            colSpan: 4,\n                            alignment: 'center'\n                        },\n                        {},\n                        {},\n                        {}\n                    ],\n                    [\n                        {\n                            text: `UUID: ${uuid} - Página ${currentPage} de ${pageCount}`,\n                            style: 'tableList',\n                            colSpan: 4,\n                            alignment: 'center'\n                        },\n                        {},\n                        {},\n                        {}\n                    ]\n                ]\n            },\n            layout: 'noBorders'\n        };\n    }\n\n    protected generateTopContent(comprobante: CNodeInterface, logo?: string): Content {\n        const header: ContentColumns = {\n            columns: [\n                {\n                    width: '*',\n                    alignment: 'left',\n                    style: 'tableContent',\n                    table: {\n                        widths: ['*'],\n                        body: [['']]\n                    },\n                    layout: 'lightHorizontalLines'\n                },\n                {\n                    width: 'auto',\n                    alignment: 'center',\n                    style: 'tableContent',\n                    table: {\n                        widths: ['auto', 'auto'],\n                        body: [\n                            ['SERIE:', { text: comprobante.get('Serie'), style: 'serieAndFolio' }],\n                            ['FOLIO:', { text: comprobante.get('Folio'), style: 'serieAndFolio' }],\n                            ['FECHA:', comprobante.get('Fecha')],\n                            ['EXPEDICIÓN:', comprobante.get('LugarExpedicion')],\n                            ['COMPROBANTE:', comprobante.get('TipoDeComprobante')],\n                            ['VERSIÓN:', comprobante.get('Version')]\n                        ]\n                    },\n                    layout: 'lightHorizontalLines'\n                }\n            ]\n        };\n        if (logo) {\n            //Se modifico para poner el logo de salsa de [80, 80]\n            (header.columns[0] as ContentTable).table.body[0][0] = { image: logo, fit: [302, 90] };\n            (header.columns[0] as ContentTable).table.widths = ['*'];\n        }\n\n        return header;\n    }\n\n    protected generateEmisorContent(emisor: CNodeInterface): Content {\n        return {\n            style: 'tableContent',\n            table: {\n                widths: ['auto', '*', 'auto', 'auto'],\n                body: [\n                    [\n                        {\n                            text: 'EMISOR',\n                            style: 'tableHeader',\n                            colSpan: 4,\n                            alignment: 'left'\n                        },\n                        {},\n                        {},\n                        {}\n                    ],\n                    ['NOMBRE:', emisor.get('Nombre'), 'RFC:', emisor.get('Rfc')],\n                    ['REGIMEN FISCAL:', { colSpan: 3, text: emisor.get('RegimenFiscal') }, {}, {}]\n                ]\n            },\n            layout: 'lightHorizontalLines'\n        };\n    }\n\n    protected generateAddress(receptor: CNodeInterface, address?: string): TableCell[][] {\n        const tableCell: TableCell[][] = [];\n        const cellAddress: TableCell[] = [];\n        if (address || receptor.offsetExists('DomicilioFiscalReceptor')) {\n            cellAddress.push('DOMICILIO:', `${address ? address + ' ' : ''}${receptor.get('DomicilioFiscalReceptor')}`);\n        }\n        cellAddress.push('USO CFDI', {\n            colSpan: address || receptor.offsetExists('DomicilioFiscalReceptor') ? 1 : 3,\n            text: receptor.get('UsoCFDI')\n        });\n        tableCell.push(cellAddress);\n        if (receptor.offsetExists('ResidenciaFiscal') && receptor.offsetExists('NumRegIdTrib')) {\n            tableCell.push([\n                'RESIDENCIA FISCAL:',\n                receptor.get('ResidenciaFiscal'),\n                'NUMERO ID TRIB.:',\n                receptor.get('NumRegIdTrib')\n            ]);\n        }\n\n        return tableCell;\n    }\n\n    protected generateReceptorContent(receptor: CNodeInterface, address?: string): Content {\n        const receptorContent: Content = {\n            style: 'tableContent',\n            table: {\n                widths: ['auto', '*', 'auto', 'auto'],\n                body: [\n                    [\n                        {\n                            text: 'RECEPTOR',\n                            style: 'tableHeader',\n                            colSpan: 4,\n                            alignment: 'left'\n                        },\n                        {},\n                        {},\n                        {}\n                    ],\n                    ['NOMBRE:', receptor.get('Nombre'), 'RFC:', receptor.get('Rfc')],\n                    ...this.generateAddress(receptor, address)\n                ]\n            },\n            layout: 'lightHorizontalLines'\n        };\n\n        if (receptor.offsetExists('RegimenFiscalReceptor')) {\n            receptorContent.table.body.push([\n                'REGIMEN FISCAL',\n                {\n                    colSpan: 3,\n                    text: receptor.get('RegimenFiscalReceptor')\n                },\n                {},\n                {}\n            ]);\n        }\n\n        return receptorContent;\n    }\n\n    protected useGlobalInformation(comprobante: CNodeInterface, currentContent: Content[]): void {\n        const globalInformation = comprobante.searchNode('cfdi:InformacionGlobal');\n        if (globalInformation === undefined) return;\n        currentContent.push({\n            style: 'tableContent',\n            table: {\n                widths: ['*', '*', '*'],\n                body: [\n                    [\n                        {\n                            text: 'INFORMACIÓN GLOBAL',\n                            style: 'tableHeader',\n                            colSpan: 3,\n                            alignment: 'left'\n                        },\n                        {},\n                        {}\n                    ],\n                    [\n                        `Periodicidad: ${globalInformation.get('Periodicidad')}`,\n                        `Meses: ${globalInformation.get('Meses')}`,\n                        `Año: ${globalInformation.get('Año')}`\n                    ]\n                ]\n            },\n            layout: 'lightHorizontalLines'\n        });\n        //currentContent.push('\\n');\n    }\n\n    protected generateGeneralInvoiceInfoContent(comprobante: CNodeInterface): Content {\n        return {\n            style: 'tableContent',\n            table: {\n                widths: [95, '*', 95, '*'],\n                body: [\n                    [\n                        {\n                            text: 'DATOS GENERALES DEL COMPROBANTE',\n                            style: 'tableHeader',\n                            colSpan: 4,\n                            alignment: 'left'\n                        },\n                        {},\n                        {},\n                        {}\n                    ],\n                    ['MONEDA:', comprobante.get('Moneda'), 'FORMA PAGO:', comprobante.get('FormaPago')],\n                    [\n                        'METODO DE PAGO:',\n                        comprobante.get('MetodoPago'),\n                        'CONDICIONES DE PAGO:',\n                        comprobante.get('CondicionesDePago')\n                    ]\n                ]\n            },\n            layout: 'lightHorizontalLines'\n        };\n    }\n\n    protected generateImpuestos(concepto: CNodeInterface): Content[] {\n        const impuestosContent: Content[] = [];\n        const traslados = concepto.searchNodes('cfdi:Impuestos', 'cfdi:Traslados', 'cfdi:Traslado');\n        const retenciones = concepto.searchNodes('cfdi:Impuestos', 'cfdi:Retenciones', 'cfdi:Retencion');\n        if (traslados.length > 0) {\n            impuestosContent.push('Traslados');\n            const contentT = traslados.map<TableCell[]>((traslado) => {\n                return [\n                    traslado.get('Impuesto'),\n                    traslado.get('TipoFactor') === 'Exento' ? 'EXENTO' : formatCurrency(traslado.get('Importe'))\n                ];\n            });\n            impuestosContent.push({\n                table: {\n                    body: contentT\n                },\n                layout: 'noBorders'\n            });\n        }\n        if (retenciones.length > 0) {\n            impuestosContent.push('Retenciones');\n            const contentR = retenciones.map<TableCell[]>((retencion) => {\n                return [retencion.get('Impuesto'), formatCurrency(retencion.get('Importe'))];\n            });\n            impuestosContent.push({\n                table: {\n                    body: contentR\n                },\n                layout: 'noBorders'\n            });\n        }\n\n        return impuestosContent;\n    }\n\n    protected generateConceptsContent(conceptos: CNodes): Content {\n        const rowsConceptos = conceptos.map<TableCell[]>((concepto) => {\n            return [\n                concepto.get('ClaveProdServ'),\n                concepto.get('Cantidad'),\n                concepto.get('ClaveUnidad'),\n                concepto.get('NoIdentificacion') || '(Ninguno)',\n                concepto.get('Descripcion'),\n                formatCurrency(concepto.get('ValorUnitario')),\n                formatCurrency(concepto.get('Descuento')),\n                {\n                    colSpan: 2,\n                    stack: this.generateImpuestos(concepto)\n                },\n                '',\n                formatCurrency(concepto.get('Importe'))\n            ];\n        });\n\n        rowsConceptos.unshift([\n            'ClaveProdServ',\n            'Cant',\n            'Clave Unidad',\n            'Identificación',\n            'Descripción',\n            'Valor Unitario',\n            'Descuento',\n            {\n                colSpan: 2,\n                text: 'Impuesto'\n            },\n            '',\n            'Importe'\n        ]);\n\n        return {\n            style: 'tableList',\n            table: {\n                widths: ['auto', 'auto', 'auto', 'auto', '*', 'auto', 'auto', 'auto', 'auto', 'auto'],\n                body: rowsConceptos\n            },\n            layout: {\n                fillColor(i): string | null {\n                    return i === 0 ? '#CCCCCC' : null;\n                }\n            }\n        };\n    }\n\n    protected generateCurrencyRelatedInfo(comprobante: CNodeInterface): Content {\n        //const totalImpuestosTrasladados = comprobante.searchAttribute('cfdi:Impuestos', 'TotalImpuestosTrasladados');\n        //const totalImpuestosRetenidos = comprobante.searchAttribute('cfdi:Impuestos', 'TotalImpuestosRetenidos');\n        //const totalTasasTraslados = comprobante.searchNodes('cfdi:Impuestos', 'cfdi:Traslados', 'cfdi:Traslado');\n        const contentColumns: Column[] = [];\n        const relatedInfoAndImport: Column[] = [];\n        if (comprobante.get('TipoDeComprobante') !== 'P') {\n            relatedInfoAndImport.push({\n                fontSize: 7,\n                margin: [0, 5, 0, 0],\n                columns: [\n                    { width: 'auto', text: 'IMPORTE CON LETRA:', margin: [0, 0, 5, 0] },\n                    {\n                        width: 'auto',\n                        text: toCurrency(parseFloat(comprobante.get('Total') || '0'), comprobante.get('Moneda'))\n                    },\n                    { width: '*', text: '' }\n                ]\n            });\n        }\n        if (comprobante.get('Version') === '3.3') {\n            const relacionados = comprobante.searchNode('cfdi:CfdiRelacionados');\n            if (relacionados) {\n                const uuidsArray = relacionados.searchNodes('cfdi:CfdiRelacionado').map((relacionado) => {\n                    return [`UUID: ${relacionado.get('UUID')}`];\n                });\n\n                relatedInfoAndImport.push({\n                    fontSize: 7,\n                    margin: [0, 5, 0, 0],\n                    table: {\n                        widths: ['*'],\n                        body: [\n                            [\n                                {\n                                    text: `CFDIS RELACIONADOS - TIPO RELACIÓN ${relacionados.get('TipoRelacion')}`,\n                                    fillColor: '#CCCCCC'\n                                }\n                            ],\n                            ...uuidsArray\n                        ]\n                    }\n                });\n            }\n        } else {\n            const relacionados = comprobante.searchNodes('cfdi:CfdiRelacionados');\n            if (relacionados.length > 0) {\n                for (const relacionadosNode of relacionados) {\n                    const uuidsArray = relacionadosNode.searchNodes('cfdi:CfdiRelacionado').map((relacionado) => {\n                        return [`UUID: ${relacionado.get('UUID')}`];\n                    });\n\n                    relatedInfoAndImport.push({\n                        fontSize: 7,\n                        margin: [0, 5, 0, 0],\n                        table: {\n                            widths: ['*'],\n                            body: [\n                                [\n                                    {\n                                        text: `CFDIS RELACIONADOS - TIPO RELACIÓN ${relacionadosNode.get(\n                                            'TipoRelacion'\n                                        )}`,\n                                        fillColor: '#CCCCCC'\n                                    }\n                                ],\n                                ...uuidsArray\n                            ]\n                        }\n                    });\n                }\n            }\n        }\n        contentColumns.push(relatedInfoAndImport);\n        if (comprobante.get('TipoDeComprobante') !== 'P' && comprobante.get('TipoDeComprobante') !== 'N') {\n            contentColumns.push({\n                width: 'auto',\n                alignment: 'right',\n                style: 'tableContent',\n                margin: [10, 0, 0, 0],\n                table: {\n                    widths: ['auto', 'auto'],\n                    body: [\n                        ['SUBTOTAL:', { text: formatCurrency(comprobante.get('SubTotal')), fontSize: 9 }],\n                        ['DESCUENTO:', formatCurrency(comprobante.get('Descuento'))],\n                        [\n                            {\n                                text: 'TOTAL:',\n                                fontSize: 11,\n                                bold: true\n                            },\n                            { text: formatCurrency(comprobante.get('Total')), fontSize: 11, bold: true }\n                        ]\n                    ]\n                },\n                layout: 'lightHorizontalLines'\n            });\n        }\n        if (comprobante.get('TipoDeComprobante') === 'N') {\n            const deducciones = comprobante.searchAttribute(\n                'cfdi:Complemento',\n                'nomina12:Nomina',\n                'nomina12:Deducciones',\n                'TotalOtrasDeducciones'\n            );\n            const impRetenidos = comprobante.searchAttribute(\n                'cfdi:Complemento',\n                'nomina12:Nomina',\n                'nomina12:Deducciones',\n                'TotalImpuestosRetenidos'\n            );\n            if (deducciones === undefined || impRetenidos === undefined) return '';\n\n            contentColumns.push({\n                width: 'auto',\n                alignment: 'right',\n                style: 'tableContent',\n                margin: [10, 0, 0, 0],\n                table: {\n                    widths: ['auto', 'auto'],\n                    body: [\n                        ['SUBTOTAL:', { text: formatCurrency(comprobante.get('SubTotal')), fontSize: 9 }],\n                        ['DESCUENTOS:', formatCurrency(deducciones)],\n                        ['RETENCIONES', formatCurrency(impRetenidos)],\n                        [\n                            {\n                                text: 'TOTAL RECIBO:',\n                                fontSize: 11,\n                                bold: true\n                            },\n                            { text: formatCurrency(comprobante.get('Total')), fontSize: 11, bold: true }\n                        ]\n                    ]\n                },\n                layout: 'lightHorizontalLines'\n            });\n        }\n\n        return {\n            columns: contentColumns\n        };\n    }\n\n    protected generateStampContent(cfdiData: CfdiData): Content {\n        const comprobante = cfdiData.comprobante();\n        const tfd = cfdiData.timbreFiscalDigital();\n        const tfdSourceString = cfdiData.tfdSourceString();\n        const qrUrl = cfdiData.qrUrl();\n        const tfdCellsTable: TableCell[][] = [];\n        if (tfd) {\n            tfdCellsTable.push(\n                [\n                    {\n                        colSpan: 1,\n                        rowSpan: 8,\n                        qr: qrUrl,\n                        fit: 120\n                    },\n                    '',\n                    ''\n                ],\n                ['', 'NUMERO SERIE CERTIFICADO SAT', tfd.get('NoCertificadoSAT')],\n                ['', 'NUMERO SERIE CERTIFICADO EMISOR', comprobante.get('NoCertificado')],\n                ['', 'FECHA HORA CERTIFICACIÓN', tfd.get('FechaTimbrado')],\n                ['', 'FOLIO FISCAL UUID', tfd.get('UUID')],\n                ['', 'SELLO DIGITAL', breakEveryNCharacters(tfd.get('SelloCFD'), 86)],\n                ['', 'SELLO DEL SAT', breakEveryNCharacters(tfd.get('SelloSAT'), 86)]\n            );\n        }\n        tfdCellsTable.push([\n            '',\n            'CADENA ORIGINAL CC:',\n            {\n                text: breakEveryNCharacters(tfdSourceString, 86)\n            }\n        ]);\n\n        return {\n            style: 'tableSat',\n            table: {\n                widths: ['auto', 'auto', '*'],\n                body: tfdCellsTable\n            },\n            layout: 'lightHorizontalLines'\n        };\n    }\n\n    protected generateNominaTopContent(comprobante: CNodeInterface): Content {\n        const nomina = comprobante.searchNode('cfdi:Complemento', 'nomina12:Nomina');\n        const receptor = comprobante.searchNode('cfdi:Receptor');\n        const nominaEmisor = comprobante.searchNode('cfdi:Complemento', 'nomina12:Nomina', 'nomina12:Emisor');\n        const nominaReceptor = comprobante.searchNode('cfdi:Complemento', 'nomina12:Nomina', 'nomina12:Receptor');\n\n        if (\n            nomina === undefined ||\n            nominaEmisor === undefined ||\n            nominaReceptor === undefined ||\n            receptor === undefined\n        )\n            return '';\n        console.log(nomina);\n        return {\n            style: 'tableContent',\n            table: {\n                widths: ['50%', '50%'],\n                body: [\n                    [\n                        {\n                            text: 'NOMINA',\n                            style: 'tableHeader',\n                            colSpan: 2,\n                            alignment: 'left'\n                        },\n                        {}\n                    ],\n                    [\n                        nominaReceptor.get('NumEmpleado') + ' - ' + receptor.get('Nombre'),\n                        'PERIODO DEL: ' + nomina.get('FechaInicialPago') + ' AL: ' + nomina.get('FechaFinalPago')\n                    ],\n                    [\n                        'RFC: \\t' + receptor.get('Rfc'),\n                        'PEROIODICIDAD PAGO: \\t' + nominaReceptor.get('PeriodicidadPago')\n                    ],\n                    ['CURP: \\t' + nominaReceptor.get('Curp'), 'FECHA PAGO: \\t' + nomina.get('FechaPago')],\n                    [\n                        'FECHA INI REL LABORAL: \\t' + nominaReceptor.get('FechaInicioRelLaboral'),\n                        'PUESTO: \\t' + nominaReceptor.get('Puesto')\n                    ],\n                    [\n                        'JORNADA: \\t' + nominaReceptor.get('TipoJornada'),\n                        'DEPARTAMENTO: \\t' + nominaReceptor.get('Departamento')\n                    ],\n                    [\n                        'NSS: \\t' + nominaReceptor.get('NumSeguridadSocial'),\n                        'SBC: \\t' + nominaReceptor.get('SalarioBaseCotApor')\n                    ],\n                    ['TIPO SALARIO: \\t' + 'MIXTO', 'SALARIO DIARIO: \\t' + nominaReceptor.get('SalarioDiarioIntegrado')],\n                    [\n                        'DOMICILIO FISCAL: \\t' + receptor.get('DomicilioFiscalReceptor'),\n                        'REGIMEN FISCAL: \\t' + receptor.get('RegimenFiscalReceptor')\n                    ]\n                ]\n            },\n            layout: 'lightHorizontalLines'\n        };\n    }\n\n    protected generateNominaMiddleContent(comprobante: CNodeInterface): Content {\n        const nominaPercepciones = comprobante.searchNodes(\n            'cfdi:Complemento',\n            'nomina12:Nomina',\n            'nomina12:Percepciones',\n            'nomina12:Percepcion'\n        );\n        const nominaDeducciones = comprobante.searchNodes(\n            'cfdi:Complemento',\n            'nomina12:Nomina',\n            'nomina12:Deducciones',\n            'nomina12:Deduccion'\n        );\n        const nominaOtrosPagos = comprobante.searchNodes(\n            'cfdi:Complemento',\n            'nomina12:Nomina',\n            'nomina12:OtrosPagos',\n            'nomina12:OtroPago'\n        );\n\n        if (nominaPercepciones === undefined || nominaDeducciones === undefined || nominaOtrosPagos === undefined)\n            return '';\n\n        const rowOtrosPagos = nominaOtrosPagos.map<TableCell[]>((otroPago) => {\n            return [\n                'OP-' + otroPago.get('TipoOtroPago'),\n                otroPago.get('Clave'),\n                otroPago.get('Concepto'),\n                formatCurrency(0.0),\n                formatCurrency(otroPago.get('Importe'))\n            ];\n        });\n        const rowsPercepciones = nominaPercepciones.map<TableCell[]>((percepcion) => {\n            return [\n                'P-' + percepcion.get('TipoPercepcion'),\n                percepcion.get('Clave'),\n                percepcion.get('Concepto'),\n                formatCurrency(percepcion.get('ImporteGravado')),\n                formatCurrency(percepcion.get('ImporteExcento'))\n            ];\n        });\n        rowOtrosPagos.forEach((pago) => {\n            rowsPercepciones.push(pago);\n        });\n        rowsPercepciones.unshift(['Tipo Percepción', 'Clave', 'Concepto', 'Importe Gravado', 'Importe Exento']);\n\n        const rowsDeducciones = nominaDeducciones.map<TableCell[]>((deduccion) => {\n            return [\n                deduccion.get('TipoDeduccion'),\n                deduccion.get('Clave'),\n                deduccion.get('Concepto'),\n                formatCurrency(deduccion.get('Importe'))\n            ];\n        });\n        rowsDeducciones.unshift(['Tipo Deducción', 'Clave', 'Concepto', 'Importe']);\n        return {\n            style: 'tableContent',\n            table: {\n                widths: ['60%', '40%'],\n                body: [\n                    [\n                        {\n                            text: 'Percepciones',\n                            style: 'tableHeader',\n                            alignment: 'left'\n                        },\n                        {\n                            text: 'Deducciones',\n                            style: 'tableHeader',\n                            alignment: 'left'\n                        }\n                    ],\n                    [\n                        {\n                            style: 'tableList',\n                            table: {\n                                widths: ['auto', 'auto', 'auto', 'auto', 'auto'],\n                                body: rowsPercepciones\n                            },\n                            layout: {\n                                fillColor(i): string | null {\n                                    return i === 0 ? '#CCCCCC' : null;\n                                }\n                            }\n                        },\n                        {\n                            style: 'tableList',\n                            table: {\n                                widths: ['auto', 'auto', 'auto', 'auto'],\n                                body: rowsDeducciones\n                            },\n                            layout: {\n                                fillColor(i): string | null {\n                                    return i === 0 ? '#CCCCCC' : null;\n                                }\n                            }\n                        }\n                    ]\n                ]\n            },\n            layout: {\n                fillColor(i): string | null {\n                    return i === 0 ? '#CCCCCC' : null;\n                }\n            }\n        };\n    }\n\n    protected generateContent(cfdiData: CfdiData): Content {\n        const comprobante = cfdiData.comprobante();\n        const emisor = cfdiData.emisor();\n        const receptor = cfdiData.receptor();\n        const conceptos = comprobante.searchNodes('cfdi:Conceptos', 'cfdi:Concepto');\n        const additionalFields = cfdiData.additionalFields();\n        const additionalFields2 = cfdiData.additionalFieldsUP();\n\n        const content: Content[] = [];\n        content.push(this.generateTopContent(comprobante, cfdiData.logo()));\n        //content.push('\\n');\n        content.push(this.generateEmisorContent(emisor));\n        //content.push('\\n');\n        if (comprobante.get('TipoDeComprobante') !== 'N') {\n            content.push(this.generateReceptorContent(receptor, cfdiData.address()));\n            //content.push('\\n');\n        }\n        if (additionalFields2) {\n            additionalFields2.forEach((element) => {\n                content.push({\n                    style: 'tableContent',\n                    table: {\n                        widths: ['*'],\n                        body: [\n                            [{ text: element.title, style: 'tableHeader' }],\n                            [{ text: element.value, style: 'infoHighlight' }]\n                        ]\n                    },\n                    layout: 'lightHorizontalLines'\n                });\n                //content.push('\\n');\n            });\n        }\n        if (comprobante.get('TipoDeComprobante') !== 'P') {\n            this.useGlobalInformation(comprobante, content);\n            content.push(this.generateGeneralInvoiceInfoContent(comprobante));\n            //content.push('\\n');\n        }\n        if (comprobante.get('TipoDeComprobante') === 'N') {\n            //Implementar el contenido de nomina\n            //Temporal Nominas\n            content.push(this.generateNominaTopContent(comprobante));\n            content.push('\\n');\n            content.push(this.generateNominaMiddleContent(comprobante));\n            content.push('\\n');\n        }\n\n        if (comprobante.get('TipoDeComprobante') !== 'N') {\n            content.push(this.generateConceptsContent(conceptos));\n            //content.push('\\n');\n        }\n        content.push(this.generateCurrencyRelatedInfo(comprobante));\n        //content.push('\\n');\n\n        /** Area of complements */\n        usePago10Complement(comprobante, content);\n        usePago20Complement(comprobante, content);\n        useImpLocal10Complement(comprobante, content);\n        /** **/\n\n        if (additionalFields) {\n            additionalFields.forEach((element) => {\n                content.push({\n                    style: 'tableContent',\n                    table: {\n                        widths: ['*'],\n                        body: [\n                            [{ text: element.title, style: 'tableHeader' }],\n                            [{ text: element.value, style: 'infoHighlight' }]\n                        ]\n                    },\n                    layout: 'lightHorizontalLines'\n                });\n                content.push('\\n');\n            });\n        }\n\n        content.push(this.generateStampContent(cfdiData));\n\n        return content;\n    }\n\n    public translate(cfdiData: CfdiData, defaultStyle: Style): TDocumentDefinitions {\n        const comprobante = cfdiData.comprobante();\n        const tfd = cfdiData.timbreFiscalDigital();\n\n        return {\n            content: this.generateContent(cfdiData),\n            styles: {\n                tableHeader: {\n                    bold: true,\n                    fontSize: 10,\n                    color: 'black'\n                },\n                infoHighlight: {\n                    fontSize: 11,\n                    color: 'black'\n                },\n                //Se agrega estilo para los datos grandes de serie y folio\n                serieAndFolio: {\n                    bold: true,\n                    fontSize: 15,\n                    color: 'red'\n                },\n                tableContent: {\n                    fontSize: 8,\n                    color: 'black',\n                    alignment: 'left'\n                },\n                tableList: {\n                    fontSize: 7,\n                    color: 'black',\n                    alignment: 'center'\n                },\n                tableSat: {\n                    fontSize: 5,\n                    color: 'black',\n                    alignment: 'left'\n                }\n            },\n            defaultStyle,\n            footer: (currentPage, pageCount) =>\n                this.generateFooter(comprobante.get('Version'), tfd.get('UUID'), currentPage, pageCount)\n        };\n    }\n}\n","import { CNodeInterface } from '@nodecfdi/cfdiutils-common';\nimport { Content, TableCell, TableLayout } from 'pdfmake/interfaces';\nimport { formatCurrency } from '../../utils/currency';\n\nconst tableLayoutBordered = (): TableLayout => {\n    return {\n        hLineWidth: (i, node): number => {\n            if (i === 0 || i === node.table.body.length) {\n                return 0.8;\n            }\n\n            return i === node.table.headerRows ? 0.8 : 0.5;\n        },\n        vLineWidth: (i, node): number => {\n            return i === 0 || i === node.table.widths?.length ? 0.8 : 0;\n        },\n        hLineColor: (i, node): string => {\n            return i === 0 || i === node.table.body.length ? 'black' : 'gray';\n        },\n        paddingLeft(i): number {\n            return i === 0 ? 0 : 8;\n        },\n        paddingRight(i, node): number {\n            return i === (node.table.widths?.length || 0) - 1 ? 0 : 8;\n        }\n    };\n};\n\nconst useImpLocal10Complement = (comprobante: CNodeInterface, currentContent: Content[]): void => {\n    // Verify if exists ImpLocal10 complement\n    const impLocal10 = comprobante.searchNode('cfdi:Complemento', 'implocal:ImpuestosLocales');\n    if (!impLocal10) return;\n\n    const bodyImpLocal10: TableCell[][] = [];\n\n    // Header imp local\n    bodyImpLocal10.push([\n        {\n            text: 'COMPLEMENTO IMPUESTOS LOCALES',\n            style: 'tableHeader',\n            colSpan: 4,\n            alignment: 'center'\n        },\n        {},\n        {},\n        {}\n    ]);\n\n    // SubHeader with values on implocal10\n    bodyImpLocal10.push([\n        'TOTAL RETENCIONES:',\n        formatCurrency(impLocal10.get('TotaldeRetenciones')),\n        'TOTAL TRASLADOS:',\n        formatCurrency(impLocal10.get('TotaldeTraslados'))\n    ]);\n\n    // if exists node retenciones locales\n    const retencionesLocales = impLocal10.searchNode('implocal:RetencionesLocales');\n    if (retencionesLocales) {\n        bodyImpLocal10.push([\n            {\n                style: 'tableContent',\n                margin: 3,\n                table: {\n                    widths: ['*', '*', '*'],\n                    body: [\n                        [\n                            {\n                                text: 'RETENCIONES LOCALES',\n                                style: 'tableHeader',\n                                colSpan: 3,\n                                alignment: 'center'\n                            },\n                            {},\n                            {}\n                        ],\n                        [\n                            {\n                                text: 'IMP LOCAL RETENIDO',\n                                fillColor: '#eeeeff',\n                                style: 'tableSubHeader',\n                                alignment: 'left'\n                            },\n                            {\n                                text: 'TASA DE RETENCIÓN',\n                                fillColor: '#eeeeff',\n                                style: 'tableSubHeader',\n                                alignment: 'left'\n                            },\n                            {\n                                text: 'IMPORTE',\n                                fillColor: '#eeeeff',\n                                style: 'tableSubHeader',\n                                alignment: 'left'\n                            }\n                        ],\n                        [\n                            retencionesLocales.get('ImpLocRetenido'),\n                            retencionesLocales.get('TasadeRetencion'),\n                            formatCurrency(retencionesLocales.get('Importe'))\n                        ]\n                    ]\n                },\n                layout: tableLayoutBordered(),\n                colSpan: 4\n            },\n            {},\n            {},\n            {}\n        ]);\n    }\n\n    // if exists node traslados locales\n    const trasladosLocales = impLocal10.searchNode('implocal:TrasladosLocales');\n    if (trasladosLocales) {\n        bodyImpLocal10.push([\n            {\n                style: 'tableContent',\n                margin: 3,\n                table: {\n                    widths: ['*', '*', '*'],\n                    body: [\n                        [\n                            {\n                                text: 'TRASLADOS LOCALES',\n                                style: 'tableHeader',\n                                colSpan: 3,\n                                alignment: 'center'\n                            },\n                            {},\n                            {}\n                        ],\n                        [\n                            {\n                                text: 'IMP LOCAL TRASLADADO',\n                                fillColor: '#eeeeff',\n                                style: 'tableSubHeader',\n                                alignment: 'left'\n                            },\n                            {\n                                text: 'TASA DE TRASLADO',\n                                fillColor: '#eeeeff',\n                                style: 'tableSubHeader',\n                                alignment: 'left'\n                            },\n                            {\n                                text: 'IMPORTE',\n                                fillColor: '#eeeeff',\n                                style: 'tableSubHeader',\n                                alignment: 'left'\n                            }\n                        ],\n                        [\n                            trasladosLocales.get('ImpLocTrasladado'),\n                            trasladosLocales.get('TasadeTraslado'),\n                            formatCurrency(trasladosLocales.get('Importe'))\n                        ]\n                    ]\n                },\n                layout: tableLayoutBordered(),\n                colSpan: 4\n            },\n            {},\n            {},\n            {}\n        ]);\n    }\n\n    currentContent.push({\n        style: 'tableContent',\n        table: {\n            widths: [95, '*', 95, '*'],\n            body: bodyImpLocal10\n        },\n        layout: tableLayoutBordered()\n    });\n    currentContent.push('\\n');\n};\n\nexport { useImpLocal10Complement };\n","import {\n    Content,\n    ContentColumns,\n    ContentTable,\n    Style,\n    TableCell,\n    TableLayout,\n    TDocumentDefinitions\n} from 'pdfmake/interfaces';\nimport { CNodeInterface, CNodes } from '@nodecfdi/cfdiutils-common';\nimport { DocumentTranslatorInterface } from './document-translator-interface';\nimport { RetencionesData } from '../retenciones-data';\nimport { breakEveryNCharacters } from '../utils/break-characters';\nimport { formatCurrency } from '../utils/currency';\n\nexport class GenericRetencionesTranslator implements DocumentTranslatorInterface<RetencionesData> {\n    public version = '1.0';\n\n    protected tableLayoutBordered(): TableLayout {\n        return {\n            hLineWidth: (i, node): number => {\n                if (i === 0 || i === node.table.body.length) {\n                    return 0.8;\n                }\n\n                return i === node.table.headerRows ? 0.8 : 0.5;\n            },\n            vLineWidth: (i, node): number => {\n                return i === 0 || i === node.table.widths?.length ? 0.8 : 0;\n            },\n            hLineColor: (i, node): string => {\n                return i === 0 || i === node.table.body.length ? 'black' : 'gray';\n            },\n            paddingLeft(i): number {\n                return i === 0 ? 0 : 8;\n            },\n            paddingRight(i, node): number {\n                return i === (node.table.widths?.length || 0) - 1 ? 0 : 8;\n            }\n        };\n    }\n\n    protected generateFooter(version: string, uuid: string, currentPage: number, pageCount: number): Content {\n        return {\n            style: 'tableContent',\n            table: {\n                widths: ['auto', '*', 'auto', 'auto'],\n                body: [\n                    [\n                        {\n                            text: `Este documento es una representación impresa de un Comprobante Fiscal Digital por Internet que ampara Retenciones e Información de Pagos versión ${version}`,\n                            style: 'tableList',\n                            colSpan: 4,\n                            alignment: 'center'\n                        },\n                        {},\n                        {},\n                        {}\n                    ],\n                    [\n                        {\n                            text: `UUID: ${uuid} - Página ${currentPage} de ${pageCount}`,\n                            style: 'tableList',\n                            colSpan: 4,\n                            alignment: 'center'\n                        },\n                        {},\n                        {},\n                        {}\n                    ]\n                ]\n            },\n            layout: 'noBorders'\n        };\n    }\n\n    protected generateTopContent(retenciones: CNodeInterface, logo?: string): Content {\n        const header: ContentColumns = {\n            columns: [\n                {\n                    width: '*',\n                    alignment: 'left',\n                    style: 'tableContent',\n                    table: {\n                        widths: ['*'],\n                        body: [['']]\n                    },\n                    layout: 'lightHorizontalLines'\n                },\n                {\n                    width: 'auto',\n                    alignment: 'center',\n                    style: 'tableContent',\n                    table: {\n                        widths: ['auto', 'auto'],\n                        body: [\n                            ['FOLIO:', retenciones.get('FolioInt')],\n                            ['FECHA:', retenciones.get('FechaExp')],\n                            ['COMPROBANTE:', 'RETENCIÓN'],\n                            ['VERSIÓN:', this.version]\n                        ]\n                    },\n                    layout: 'lightHorizontalLines'\n                }\n            ]\n        };\n        if (logo) {\n            (header.columns[0] as ContentTable).table.body[0][0] = { image: logo, fit: [80, 80] };\n            (header.columns[0] as ContentTable).table.widths = ['*'];\n        }\n\n        return header;\n    }\n\n    protected generateEmisorContent(emisor: CNodeInterface): Content {\n        const body: TableCell[][] = [];\n        body.push([\n            {\n                text: 'EMISOR',\n                style: 'tableHeader',\n                colSpan: 4,\n                alignment: 'left'\n            },\n            {},\n            {},\n            {}\n        ]);\n        body.push([\n            'NOMBRE:',\n            emisor.get('NomDenRazSocE'),\n            'RFC:',\n            emisor.get(this.version === '1.0' ? 'RFCEmisor' : 'RfcE')\n        ]);\n\n        if (this.version === '2.0') {\n            body.push(['REGIMEN FISCAL:', emisor.get('RegimenFiscalE'), '', '']);\n        }\n\n        return {\n            style: 'tableContent',\n            table: {\n                widths: ['auto', '*', 'auto', 'auto'],\n                body: body\n            },\n            layout: this.tableLayoutBordered()\n        };\n    }\n\n    protected generateReceptorContent(receptor: CNodeInterface): Content {\n        const nacionalidad = receptor.get(this.version === '1.0' ? 'Nacionalidad' : 'NacionalidadR');\n        const infoReceptor: TableCell[] = [];\n        let domicilioFiscal = '';\n        if (nacionalidad === 'Nacional') {\n            const nacional = receptor.searchNode('retenciones:Nacional');\n            if (nacional) {\n                infoReceptor.push(\n                    'NOMBRE:',\n                    nacional.get('NomDenRazSocR'),\n                    'RFC:',\n                    nacional.get(this.version === '1.0' ? 'RFCRecep' : 'RfcR')\n                );\n                domicilioFiscal = nacional.get('DomicilioFiscalR');\n            }\n        } else {\n            const extranjero = receptor.searchNode('retenciones:Extranjero');\n            if (extranjero) {\n                infoReceptor.push(\n                    'NOMBRE:',\n                    extranjero.get('NomDenRazSocR'),\n                    'NUM. REG. ID TRIB.:',\n                    extranjero.get(this.version === '1.0' ? 'NumRegIdTrib' : 'NumRegIdTribR')\n                );\n            }\n        }\n        const body: TableCell[][] = [];\n        body.push([\n            {\n                text: 'RECEPTOR',\n                style: 'tableHeader',\n                colSpan: 4,\n                alignment: 'left'\n            },\n            {},\n            {},\n            {}\n        ]);\n        body.push([\n            'NACIONALIDAD:',\n            nacionalidad,\n            this.version === '2.0' && nacionalidad === 'Nacional' ? 'DOMICILIO FISCAL:' : '',\n            this.version === '2.0' && nacionalidad === 'Nacional' ? domicilioFiscal : ''\n        ]);\n        body.push(infoReceptor);\n\n        return {\n            style: 'tableContent',\n            table: {\n                widths: ['auto', '*', 'auto', 'auto'],\n                body: body\n            },\n            layout: this.tableLayoutBordered()\n        };\n    }\n\n    protected generatePeriodoContent(periodo: CNodeInterface, claveRet: string): Content {\n        return {\n            style: 'tableContent',\n            table: {\n                widths: ['*', '*', '*', '*'],\n                body: [\n                    [\n                        {\n                            text: 'PERIODO MES INICIAL',\n                            style: 'tableHeader',\n                            alignment: 'left'\n                        },\n                        {\n                            text: 'PERIODO MES FINAL',\n                            style: 'tableHeader',\n                            alignment: 'left'\n                        },\n                        {\n                            text: 'PERIODO EJERCICIO ANUAL',\n                            style: 'tableHeader',\n                            alignment: 'left'\n                        },\n                        {\n                            text: 'TIPO DE RETENCION',\n                            style: 'tableHeader',\n                            alignment: 'left'\n                        }\n                    ],\n                    [\n                        periodo.get('MesIni'),\n                        periodo.get('MesFin'),\n                        periodo.get(this.version === '1.0' ? 'Ejerc' : 'Ejercicio'),\n                        claveRet\n                    ]\n                ]\n            },\n            layout: this.tableLayoutBordered()\n        };\n    }\n\n    protected generateImpuestosRetenidos(impuestosRetenidos: CNodeInterface[]): TableCell[][] {\n        const rowsRetenciones: TableCell[][] = [];\n        if (impuestosRetenidos.length > 0) {\n            rowsRetenciones.push([\n                {\n                    text: 'IMPUESTOS RETENIDOS',\n                    style: 'tableHeader',\n                    colSpan: 3,\n                    alignment: 'center'\n                },\n                {},\n                {}\n            ]);\n            rowsRetenciones.push([\n                {\n                    text: 'TIPO DE IMPUESTO',\n                    style: 'tableSubHeader',\n                    fillColor: '#eeeeff',\n                    alignment: 'left'\n                },\n                {\n                    text: 'TIPO DE PAGO',\n                    style: 'tableSubHeader',\n                    fillColor: '#eeeeff',\n                    alignment: 'left'\n                },\n                {\n                    text: 'MONTO RETENIDO',\n                    style: 'tableSubHeader',\n                    fillColor: '#eeeeff',\n                    alignment: 'left'\n                }\n            ]);\n        }\n        impuestosRetenidos.forEach((impuestoRetenido) => {\n            rowsRetenciones.push([\n                impuestoRetenido.get(this.version === '1.0' ? 'Impuesto' : 'ImpuestoRet'),\n                impuestoRetenido.get('TipoPagoRet'),\n                formatCurrency(impuestoRetenido.get(this.version === '1.0' ? 'montoRet' : 'MontoRet'))\n            ]);\n        });\n\n        return rowsRetenciones;\n    }\n\n    protected generateTotales(totales: CNodeInterface): Content {\n        const impuestosRetenidos = totales.searchNodes('retenciones:ImpRetenidos');\n        const impuestosRetenidosBody: TableCell[][] = this.generateImpuestosRetenidos(impuestosRetenidos);\n\n        return {\n            style: 'tableContent',\n            table: {\n                widths: ['*', '*', '*', '*'],\n                body: [\n                    [\n                        {\n                            text: 'TOTALES',\n                            style: 'tableHeader',\n                            colSpan: 4,\n                            alignment: 'center'\n                        },\n                        {},\n                        {},\n                        {}\n                    ],\n                    [\n                        {\n                            text: 'MONTO TOTAL DE OPERACIÓN',\n                            style: 'tableSubHeader',\n                            fillColor: '#eeeeff',\n                            alignment: 'left'\n                        },\n                        {\n                            text: 'MONTO TOTAL GRAVADO',\n                            style: 'tableSubHeader',\n                            fillColor: '#eeeeff',\n                            alignment: 'left'\n                        },\n                        {\n                            text: 'MONTO TOTAL EXENTO',\n                            style: 'tableSubHeader',\n                            fillColor: '#eeeeff',\n                            alignment: 'left'\n                        },\n                        {\n                            text: 'MONTO TOTAL RETENIDO',\n                            style: 'tableSubHeader',\n                            fillColor: '#eeeeff',\n                            alignment: 'left'\n                        }\n                    ],\n                    [\n                        formatCurrency(totales.get(this.version === '1.0' ? 'montoTotOperacion' : 'MontoTotOperacion')),\n                        formatCurrency(totales.get(this.version === '1.0' ? 'montoTotGrav' : 'MontoTotGrav')),\n                        formatCurrency(totales.get(this.version === '1.0' ? 'montoTotExent' : 'MontoTotExent')),\n                        formatCurrency(totales.get(this.version === '1.0' ? 'montoTotRet' : 'MontoTotRet'))\n                    ],\n                    [\n                        {\n                            style: 'tableContent',\n                            margin: 5,\n                            colSpan: 4,\n                            table: {\n                                widths: ['*', '*', '*'],\n                                body: impuestosRetenidosBody\n                            },\n                            layout: this.tableLayoutBordered()\n                        },\n                        {},\n                        {},\n                        {}\n                    ]\n                ]\n            },\n            layout: this.tableLayoutBordered()\n        };\n    }\n\n    protected generateStampContent(data: RetencionesData): Content {\n        const retenciones = data.retenciones();\n        const tfd = data.timbreFiscalDigital();\n        const tfdVersion = tfd.get(this.version === '1.0' ? 'version' : 'Version');\n        const tfdSourceString = data.tfdSourceString();\n        const qrUrl = data.qrUrl();\n        const tfdCellsTable: TableCell[][] = [];\n        if (tfd) {\n            tfdCellsTable.push(\n                [\n                    {\n                        colSpan: 1,\n                        rowSpan: 8,\n                        qr: qrUrl,\n                        fit: 100\n                    },\n                    '',\n                    ''\n                ],\n                [\n                    '',\n                    'NUMERO SERIE CERTIFICADO SAT',\n                    tfd.get(tfdVersion === '1.0' ? 'noCertificadoSAT' : 'NoCertificadoSAT')\n                ],\n                [\n                    '',\n                    'NUMERO SERIE CERTIFICADO EMISOR',\n                    retenciones.get(this.version === '1.0' ? 'NumCert' : 'NoCertificado')\n                ],\n                ['', 'FECHA HORA CERTIFICACIÓN', tfd.get('FechaTimbrado')],\n                ['', 'FOLIO FISCAL UUID', tfd.get('UUID')],\n                [\n                    '',\n                    'SELLO DIGITAL',\n                    breakEveryNCharacters(tfd.get(tfdVersion === '1.0' ? 'selloCFD' : 'SelloCFD'), 86)\n                ],\n                [\n                    '',\n                    'SELLO DEL SAT',\n                    breakEveryNCharacters(tfd.get(tfdVersion === '1.0' ? 'selloSAT' : 'SelloSAT'), 86)\n                ]\n            );\n        }\n        tfdCellsTable.push([\n            '',\n            'CADENA ORIGINAL CC:',\n            {\n                text: breakEveryNCharacters(tfdSourceString, 86)\n            }\n        ]);\n\n        return {\n            style: 'tableSat',\n            table: {\n                widths: ['auto', 'auto', '*'],\n                body: tfdCellsTable\n            },\n            layout: 'lightHorizontalLines'\n        };\n    }\n\n    protected contentService(service: CNodeInterface): TableCell[][] {\n        const tableService: TableCell[][] = [];\n        // SubHeaders per service\n        tableService.push([\n            {\n                text: 'FORMA DE PAGO',\n                style: 'tableSubHeader',\n                fillColor: '#eeeeff',\n                alignment: 'left'\n            },\n            {\n                text: 'TIPO DE SERVICIO',\n                style: 'tableSubHeader',\n                fillColor: '#eeeeff',\n                alignment: 'left'\n            },\n            {\n                text: 'FECHA DE PAGO',\n                style: 'tableSubHeader',\n                fillColor: '#eeeeff',\n                alignment: 'left'\n            },\n            {\n                text: 'PRECIO DE SERVICIO',\n                style: 'tableSubHeader',\n                fillColor: '#eeeeff',\n                alignment: 'left'\n            }\n        ]);\n        tableService.push([\n            service.get('FormaPagoServ'),\n            service.get('TipoDeServ'),\n            service.get('FechaServ'),\n            formatCurrency(service.get('PrecioServSinIVA'))\n        ]);\n        if (service.offsetExists('SubTipServ') || service.offsetExists('RFCTerceroAutorizado')) {\n            tableService.push([\n                {\n                    text: 'SUBTIPO DE SERVICIO',\n                    style: 'tableSubHeader',\n                    fillColor: '#eeeeff',\n                    alignment: 'left'\n                },\n                {\n                    text: 'RFC TERCERO AUTORIZADO',\n                    style: 'tableSubHeader',\n                    fillColor: '#eeeeff',\n                    alignment: 'left'\n                },\n                '',\n                ''\n            ]);\n            tableService.push([service.get('SubTipServ'), service.get('RFCTerceroAutorizado'), '', '']);\n        }\n        const impuestosTrasladadosDelServicio = service.searchNode(\n            'plataformasTecnologicas:ImpuestosTrasladadosdelServicio'\n        );\n        const contribucionGubernamental = service.searchNode('plataformasTecnologicas:ContribucionGubernamental');\n        const comisionDelServicio = service.searchNode('plataformasTecnologicas:ComisionDelServicio');\n\n        if (impuestosTrasladadosDelServicio) {\n            tableService.push([\n                {\n                    style: 'tableContent',\n                    margin: 3,\n                    table: {\n                        widths: ['*', '*', '*', '*', '*'],\n                        body: [\n                            [\n                                {\n                                    text: 'IMPUESTOS TRASLADADOS DEL SERVICIO',\n                                    style: 'tableHeader',\n                                    colSpan: 5,\n                                    alignment: 'center'\n                                },\n                                {},\n                                {},\n                                {},\n                                {}\n                            ],\n                            [\n                                {\n                                    text: 'IMPUESTO BASE',\n                                    style: 'tableSubHeader',\n                                    fillColor: '#eeeeff',\n                                    alignment: 'left'\n                                },\n                                {\n                                    text: 'IMPUESTO',\n                                    style: 'tableSubHeader',\n                                    fillColor: '#eeeeff',\n                                    alignment: 'left'\n                                },\n                                {\n                                    text: 'TIPO FACTOR',\n                                    style: 'tableSubHeader',\n                                    fillColor: '#eeeeff',\n                                    alignment: 'left'\n                                },\n                                {\n                                    text: 'TASA O CUOTA',\n                                    style: 'tableSubHeader',\n                                    fillColor: '#eeeeff',\n                                    alignment: 'left'\n                                },\n                                {\n                                    text: 'IMPORTE',\n                                    style: 'tableSubHeader',\n                                    fillColor: '#eeeeff',\n                                    alignment: 'left'\n                                }\n                            ],\n                            [\n                                formatCurrency(impuestosTrasladadosDelServicio.get('Base')),\n                                impuestosTrasladadosDelServicio.get('Impuesto'),\n                                impuestosTrasladadosDelServicio.get('TipoFactor'),\n                                impuestosTrasladadosDelServicio.get('TasaCuota'),\n                                formatCurrency(impuestosTrasladadosDelServicio.get('Importe'))\n                            ]\n                        ]\n                    },\n                    layout: this.tableLayoutBordered(),\n                    colSpan: 4\n                },\n                {},\n                {},\n                {}\n            ]);\n        }\n\n        if (contribucionGubernamental) {\n            tableService.push([\n                {\n                    style: 'tableContent',\n                    margin: 3,\n                    table: {\n                        widths: ['*', '*'],\n                        body: [\n                            [\n                                {\n                                    text: 'CONTRIBUCIÓN GUBERNAMENTAL',\n                                    style: 'tableHeader',\n                                    colSpan: 2,\n                                    alignment: 'center'\n                                },\n                                {}\n                            ],\n                            [\n                                {\n                                    text: 'ESTADO',\n                                    style: 'tableSubHeader',\n                                    fillColor: '#eeeeff',\n                                    alignment: 'left'\n                                },\n                                {\n                                    text: 'IMPORTE',\n                                    style: 'tableSubHeader',\n                                    fillColor: '#eeeeff',\n                                    alignment: 'left'\n                                }\n                            ],\n                            [\n                                contribucionGubernamental.get('EntidadDondePagaLaContribucion'),\n                                formatCurrency(contribucionGubernamental.get('ImpContrib'))\n                            ]\n                        ]\n                    },\n                    layout: this.tableLayoutBordered(),\n                    colSpan: 4\n                },\n                {},\n                {},\n                {}\n            ]);\n        }\n\n        if (comisionDelServicio) {\n            tableService.push([\n                {\n                    style: 'tableContent',\n                    margin: 3,\n                    table: {\n                        widths: ['*', '*', '*'],\n                        body: [\n                            [\n                                {\n                                    text: 'COMISIÓN DEL SERVICIO',\n                                    style: 'tableHeader',\n                                    colSpan: 3,\n                                    alignment: 'center'\n                                },\n                                {},\n                                {}\n                            ],\n                            [\n                                {\n                                    text: 'BASE',\n                                    style: 'tableSubHeader',\n                                    fillColor: '#eeeeff',\n                                    alignment: 'left'\n                                },\n                                {\n                                    text: 'PORCENTAJE',\n                                    style: 'tableSubHeader',\n                                    fillColor: '#eeeeff',\n                                    alignment: 'left'\n                                },\n                                {\n                                    text: 'IMPORTE',\n                                    style: 'tableSubHeader',\n                                    fillColor: '#eeeeff',\n                                    alignment: 'left'\n                                }\n                            ],\n                            [\n                                formatCurrency(comisionDelServicio.get('Base')),\n                                comisionDelServicio.get('Porcentaje'),\n                                formatCurrency(comisionDelServicio.get('Importe'))\n                            ]\n                        ]\n                    },\n                    layout: this.tableLayoutBordered(),\n                    colSpan: 4\n                },\n                {},\n                {},\n                {}\n            ]);\n        }\n\n        return tableService;\n    }\n\n    protected generateContentPerService(servicios: CNodes): TableCell[][] {\n        const tableServices: TableCell[][] = [];\n        // Header global\n        tableServices.push([\n            {\n                text: 'SERVICIOS',\n                style: 'tableHeader',\n                alignment: 'center'\n            }\n        ]);\n        // Per Services\n        servicios.forEach((servicio) => {\n            tableServices.push([\n                {\n                    margin: 5,\n                    style: 'tableContent',\n                    table: {\n                        widths: ['*', '*', '*', '*'],\n                        body: this.contentService(servicio)\n                    },\n                    layout: this.tableLayoutBordered()\n                }\n            ]);\n        });\n\n        return tableServices;\n    }\n\n    protected generatePlataformasTecnologicas(plataformasTecnologicas: CNodeInterface): Content {\n        const servicios = plataformasTecnologicas.searchNodes(\n            'plataformasTecnologicas:Servicios',\n            'plataformasTecnologicas:DetallesDelServicio'\n        );\n        const bodyPlataformasTecnologicas: TableCell[][] = [];\n        // Header global\n        bodyPlataformasTecnologicas.push([\n            {\n                text: 'SERVICIO MEDIANTE PLATAFORMAS TECNOLÓGICAS',\n                style: 'tableHeader',\n                colSpan: 5,\n                alignment: 'center'\n            },\n            {},\n            {},\n            {},\n            {}\n        ]);\n        // SubHeaders of global\n        bodyPlataformasTecnologicas.push([\n            {\n                text: 'VERSION',\n                fillColor: '#eeeeff',\n                style: 'tableSubHeader',\n                alignment: 'left'\n            },\n            {\n                text: 'PERIODICIDAD',\n                fillColor: '#eeeeff',\n                style: 'tableSubHeader',\n                alignment: 'left'\n            },\n            {\n                text: 'NUMERO SERVICIOS',\n                fillColor: '#eeeeff',\n                style: 'tableSubHeader',\n                alignment: 'left'\n            },\n            {\n                text: 'SUBTOTAL OPERACIONES',\n                fillColor: '#eeeeff',\n                style: 'tableSubHeader',\n                alignment: 'left'\n            },\n            {\n                text: 'TOTAL IVA',\n                fillColor: '#eeeeff',\n                style: 'tableSubHeader',\n                alignment: 'left'\n            }\n        ]);\n        bodyPlataformasTecnologicas.push([\n            plataformasTecnologicas.get('Version'),\n            plataformasTecnologicas.get('Periodicidad'),\n            plataformasTecnologicas.get('NumServ'),\n            formatCurrency(plataformasTecnologicas.get('MonTotServSIVA')),\n            formatCurrency(plataformasTecnologicas.get('TotalIVATrasladado'))\n        ]);\n        bodyPlataformasTecnologicas.push([\n            {\n                text: 'TOTAL IVA RETENIDO',\n                fillColor: '#eeeeff',\n                style: 'tableSubHeader',\n                alignment: 'left'\n            },\n            {\n                text: 'TOTAL ISR RETENIDO',\n                fillColor: '#eeeeff',\n                style: 'tableSubHeader',\n                alignment: 'left'\n            },\n            {\n                text: 'DIFERENCIA IVA',\n                fillColor: '#eeeeff',\n                style: 'tableSubHeader',\n                alignment: 'left'\n            },\n            {\n                text: 'TOTAL USO DE PLATAFORMA',\n                fillColor: '#eeeeff',\n                style: 'tableSubHeader',\n                alignment: 'left'\n            },\n            {\n                text: 'TOTAL CONTRIBUCIÓN GUBERNAMENTAL',\n                fillColor: '#eeeeff',\n                style: 'tableSubHeader',\n                alignment: 'left'\n            }\n        ]);\n        bodyPlataformasTecnologicas.push([\n            formatCurrency(plataformasTecnologicas.get('TotalIVARetenido')),\n            formatCurrency(plataformasTecnologicas.get('TotalISRRetenido')),\n            formatCurrency(plataformasTecnologicas.get('DifIVAEntregadoPrestServ')),\n            formatCurrency(plataformasTecnologicas.get('MonTotalporUsoPlataforma')),\n            plataformasTecnologicas.get('MonTotalContribucionGubernamental') !== ''\n                ? formatCurrency(plataformasTecnologicas.get('MonTotalContribucionGubernamental'))\n                : ''\n        ]);\n\n        if (servicios.length > 0) {\n            bodyPlataformasTecnologicas.push([\n                {\n                    style: 'tableContent',\n                    margin: 3,\n                    table: {\n                        widths: ['*'],\n                        body: this.generateContentPerService(servicios)\n                    },\n                    layout: this.tableLayoutBordered(),\n                    colSpan: 5\n                },\n                {},\n                {},\n                {},\n                {}\n            ]);\n        }\n\n        return {\n            style: 'tableContent',\n            table: {\n                widths: ['*', '*', '*', '*', '*'],\n                body: bodyPlataformasTecnologicas\n            },\n            layout: this.tableLayoutBordered()\n        };\n    }\n\n    protected generateContent(data: RetencionesData): Content {\n        const retenciones = data.retenciones();\n        const emisor = data.emisor();\n        const receptor = data.receptor();\n        const periodo = data.periodo();\n        const totales = data.totales();\n        const additionalFields = data.additionalFields();\n        const plataformasTecnologicas = retenciones.searchNode(\n            'retenciones:Complemento',\n            'plataformasTecnologicas:ServiciosPlataformasTecnologicas'\n        );\n        const content: Content[] = [];\n        content.push(this.generateTopContent(retenciones, data.logo()));\n        content.push('\\n');\n        content.push(this.generateEmisorContent(emisor));\n        content.push('\\n');\n        content.push(this.generateReceptorContent(receptor));\n        content.push('\\n');\n        content.push('\\n');\n        content.push(this.generatePeriodoContent(periodo, retenciones.get('CveRetenc')));\n        content.push('\\n');\n        content.push(this.generateTotales(totales));\n        content.push('\\n');\n        if (plataformasTecnologicas) {\n            content.push(this.generatePlataformasTecnologicas(plataformasTecnologicas));\n            content.push('\\n');\n        }\n        if (additionalFields) {\n            additionalFields.forEach((element) => {\n                content.push({\n                    style: 'tableContent',\n                    table: {\n                        widths: ['*'],\n                        body: [[{ text: element.title, style: 'tableHeader' }], [element.value]]\n                    },\n                    layout: 'lightHorizontalLines'\n                });\n                content.push('\\n');\n            });\n        }\n        content.push(this.generateStampContent(data));\n\n        return content;\n    }\n\n    public translate(data: RetencionesData, defaultStyle: Style): TDocumentDefinitions {\n        const retenciones = data.retenciones();\n        const tfd = data.timbreFiscalDigital();\n        this.version = retenciones.get('Version');\n\n        return {\n            content: this.generateContent(data),\n            styles: {\n                tableHeader: {\n                    bold: true,\n                    fontSize: 10,\n                    color: 'black'\n                },\n                tableSubHeader: {\n                    bold: true,\n                    fontSize: 9,\n                    color: 'black'\n                },\n                tableContent: {\n                    fontSize: 8,\n                    color: 'black',\n                    alignment: 'left'\n                },\n                tableList: {\n                    fontSize: 7,\n                    color: 'black',\n                    alignment: 'center'\n                },\n                tableSat: {\n                    fontSize: 5,\n                    color: 'black',\n                    alignment: 'left'\n                }\n            },\n            defaultStyle,\n            footer: (currentPage, pageCount) =>\n                this.generateFooter(this.version, tfd.get('UUID'), currentPage, pageCount)\n        };\n    }\n}\n","/* istanbul ignore file */\nimport { Style, TDocumentDefinitions } from 'pdfmake/interfaces';\nimport { BuilderInterface } from './builder-interface';\nimport { DocumentTranslatorInterface } from '../templates/document-translator-interface';\nimport { AbstractInvoiceData } from '../abstract-invoice-data';\nimport { getPdfMake, PdfMakeBrowser } from '../pdfmake-builder';\n\nexport class PdfMakerBrowserBuilder<T extends AbstractInvoiceData> implements BuilderInterface<T> {\n    private _documentTranslator: DocumentTranslatorInterface<T>;\n\n    private readonly _defaultStyle: Style;\n\n    constructor(documentTranslator: DocumentTranslatorInterface<T>, defaultStyle?: Style) {\n        this._documentTranslator = documentTranslator;\n        if (!defaultStyle) {\n            defaultStyle = {\n                font: 'Roboto'\n            };\n        }\n        this._defaultStyle = defaultStyle;\n    }\n\n    public build(_data: T, _destination: string): Promise<void> {\n        console.warn('This method not permitted on browser');\n\n        return Promise.reject('Method not work on browser');\n    }\n\n    public buildBase64(data: T): Promise<string> {\n        return new Promise<string>((resolve, reject) => {\n            try {\n                const pdfTemplate = this.buildPdf(data);\n                const pfdDocGenerator = getPdfMake<PdfMakeBrowser>().createPdf(pdfTemplate);\n                pfdDocGenerator.getBase64((pdfBase64) => {\n                    resolve(pdfBase64);\n                });\n            } catch (e) {\n                reject(e);\n            }\n        });\n    }\n\n    public buildPdf(data: T): TDocumentDefinitions {\n        return this._documentTranslator.translate(data, this._defaultStyle);\n    }\n}\n","import { Style, TDocumentDefinitions } from 'pdfmake/interfaces';\nimport { BuilderInterface } from './builder-interface';\nimport { DocumentTranslatorInterface } from '../templates/document-translator-interface';\nimport { AbstractInvoiceData } from '../abstract-invoice-data';\nimport { getPdfMake, PdfMakeNode } from '../pdfmake-builder';\n\nexport class PdfMakerBuilder<T extends AbstractInvoiceData> implements BuilderInterface<T> {\n    private readonly _documentTranslator: DocumentTranslatorInterface<T>;\n\n    private readonly _defaultStyle: Style;\n\n    constructor(documentTranslator: DocumentTranslatorInterface<T>, defaultStyle?: Style) {\n        this._documentTranslator = documentTranslator;\n        if (!defaultStyle) {\n            defaultStyle = {\n                font: 'Roboto'\n            };\n        }\n        this._defaultStyle = defaultStyle;\n    }\n\n    public build(data: T, destination: string): Promise<void> {\n        return new Promise<void>((resolve, reject) => {\n            // eslint-disable-next-line @typescript-eslint/no-var-requires\n            const fs = require('fs');\n            const pdfTemplate = this.buildPdf(data);\n            const pdfStream = getPdfMake<PdfMakeNode>().createPdfKitDocument(pdfTemplate, {});\n            const fileWriteStream = fs.createWriteStream(destination);\n            fileWriteStream.on('error', (err: Error) => {\n                fileWriteStream.end();\n\n                return reject(err);\n            });\n\n            pdfStream.pipe(fileWriteStream);\n            pdfStream.on('end', () => {\n                return resolve();\n            });\n            pdfStream.on('error', (err) => {\n                /* istanbul ignore next */\n                return reject(err);\n            });\n            pdfStream.end();\n        });\n    }\n\n    public buildBase64(data: T): Promise<string> {\n        return new Promise<string>((resolve, reject) => {\n            const pdfTemplate = this.buildPdf(data);\n            const pdfStream = getPdfMake<PdfMakeNode>().createPdfKitDocument(pdfTemplate, {});\n            const chunks: Uint8Array[] = [];\n            pdfStream.on('data', (chunk) => {\n                chunks.push(chunk);\n            });\n            pdfStream.on('end', () => {\n                return resolve(Buffer.concat(chunks).toString('base64'));\n            });\n            pdfStream.on('error', (err) => {\n                /* istanbul ignore next */\n                return reject(err);\n            });\n            pdfStream.end();\n        });\n    }\n\n    public buildPdf(data: T): TDocumentDefinitions {\n        return this._documentTranslator.translate(data, this._defaultStyle);\n    }\n}\n","import { CNodeInterface } from '@nodecfdi/cfdiutils-common';\nimport { AbstractInvoiceData } from './abstract-invoice-data';\n\nexport class RetencionesData extends AbstractInvoiceData {\n    private readonly _retenciones: CNodeInterface;\n\n    private readonly _periodo: CNodeInterface;\n\n    private readonly _totales: CNodeInterface;\n\n    constructor(\n        retenciones: CNodeInterface,\n        qrUrl: string,\n        tfdSourceString: string,\n        logo?: string,\n        additionalFields?: { title: string; value: string }[],\n        additionalFieldsUP?: { title: string; value: string }[]\n    ) {\n        super();\n        const emisor = retenciones.searchNode('retenciones:Emisor');\n        if (!emisor) {\n            throw new Error('La factura de retenciones no contiene nodo emisor');\n        }\n        const receptor = retenciones.searchNode('retenciones:Receptor');\n        if (!receptor) {\n            throw new Error('La factura de retenciones no contiene nodo receptor');\n        }\n        const periodo = retenciones.searchNode('retenciones:Periodo');\n        if (!periodo) {\n            throw new Error('La factura de retenciones no contiene nodo periodo');\n        }\n        const totales = retenciones.searchNode('retenciones:Totales');\n        if (!totales) {\n            throw new Error('La factura de retenciones no contiene nodo totales');\n        }\n        const timbreFiscalDigital = retenciones.searchNode('retenciones:Complemento', 'tfd:TimbreFiscalDigital');\n        if (!timbreFiscalDigital) {\n            throw new Error('La factura de retenciones no contiene complemento de timbre fiscal digital');\n        }\n\n        this._retenciones = retenciones;\n        this._emisor = emisor;\n        this._receptor = receptor;\n        this._periodo = periodo;\n        this._totales = totales;\n        this._timbreFiscalDigital = timbreFiscalDigital;\n        this._qrUrl = qrUrl;\n        this._tfdSourceString = tfdSourceString;\n        this._logo = logo;\n        this._additionalFields = additionalFields;\n        this._additionalFieldsUP = additionalFieldsUP;\n        if (this._qrUrl.trim().length === 0) {\n            this.buildUrlQr(this._retenciones);\n        }\n    }\n\n    public retenciones(): CNodeInterface {\n        return this._retenciones;\n    }\n\n    public periodo(): CNodeInterface {\n        return this._periodo;\n    }\n\n    public totales(): CNodeInterface {\n        return this._totales;\n    }\n}\n"],"names":["AbstractInvoiceData","constructor","this","_emisor","_receptor","_timbreFiscalDigital","_qrUrl","_tfdSourceString","_logo","_additionalFields","_additionalFieldsUP","emisor","receptor","timbreFiscalDigital","qrUrl","tfdSourceString","logo","additionalFields","additionalFieldsUP","buildUrlQr","node","rawString","XmlNodeUtils","nodeToXmlString","document","getParser","parseFromString","DiscoverExtractor","extract","e","getGroupToCurrency","group","basics","teens","hundreds","toCurrency","length","parseInt","substring","zeroAtTheEnd","num","moneda","number","toFixed","integers","indexOf","decimals","monedaName","numberToCurrency","noThousands","noHundreds","thousandsOfMillions","toUpperCase","Error","formatCurrency","currency","Number","isNaN","Intl","NumberFormat","style","currencyDisplay","format","breakEveryNCharacters","str","n","arr","match","RegExp","result","reduce","a","b","PdfmakeNotFound","msg","super","name","_pdfmake","getPdfMake","generateRelatedDocsContent","doctoRelacionados","relatedDocsCells","map","doc","get","unshift","text","colSpan","alignment","checkAndAddTotal","totales","attribute","rowToInsert","offsetExists","push","fontSize","generateTotalesInfoContent","totalesCells","firstRow","secondRow","bold","border","limit","i","comprobante","address","_comprobante","_address","searchNode","trim","generateFooter","version","uuid","currentPage","pageCount","table","widths","body","layout","generateTopContent","header","columns","width","image","fit","generateEmisorContent","generateAddress","tableCell","cellAddress","generateReceptorContent","receptorContent","useGlobalInformation","currentContent","globalInformation","undefined","generateGeneralInvoiceInfoContent","generateImpuestos","concepto","impuestosContent","traslados","searchNodes","retenciones","contentT","traslado","contentR","retencion","generateConceptsContent","conceptos","rowsConceptos","stack","fillColor","generateCurrencyRelatedInfo","contentColumns","relatedInfoAndImport","margin","parseFloat","relacionados","uuidsArray","relacionado","relacionadosNode","deducciones","searchAttribute","impRetenidos","generateStampContent","cfdiData","tfd","tfdCellsTable","rowSpan","qr","generateNominaTopContent","nomina","nominaEmisor","nominaReceptor","console","log","generateNominaMiddleContent","nominaPercepciones","nominaDeducciones","nominaOtrosPagos","rowOtrosPagos","otroPago","rowsPercepciones","percepcion","forEach","pago","rowsDeducciones","deduccion","generateContent","additionalFields2","content","element","title","value","usePago10Complement","pago10","pagos","usePago20Complement","pago20","useImpLocal10Complement","impLocal10","bodyImpLocal10","retencionesLocales","hLineWidth","headerRows","vLineWidth","hLineColor","paddingLeft","paddingRight","trasladosLocales","translate","defaultStyle","styles","tableHeader","color","infoHighlight","serieAndFolio","tableContent","tableList","tableSat","footer","tableLayoutBordered","nacionalidad","infoReceptor","domicilioFiscal","nacional","extranjero","generatePeriodoContent","periodo","claveRet","generateImpuestosRetenidos","impuestosRetenidos","rowsRetenciones","impuestoRetenido","generateTotales","impuestosRetenidosBody","data","tfdVersion","contentService","service","tableService","impuestosTrasladadosDelServicio","contribucionGubernamental","comisionDelServicio","generateContentPerService","servicios","tableServices","servicio","generatePlataformasTecnologicas","plataformasTecnologicas","bodyPlataformasTecnologicas","tableSubHeader","documentTranslator","_documentTranslator","_defaultStyle","font","build","_data","_destination","warn","Promise","reject","buildBase64","resolve","pdfTemplate","buildPdf","createPdf","getBase64","pdfBase64","destination","fs","require","pdfStream","createPdfKitDocument","fileWriteStream","createWriteStream","on","err","end","pipe","chunks","chunk","Buffer","concat","toString","_retenciones","_periodo","_totales","pdfMake"],"mappings":"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"}